{% load static %}
<!-- Vendor JS -->
<script src="{% static 'assets/vendor/jquery/dist/jquery.min.js' %}"></script>
<script src="{% static 'assets/vendor/js-cookie/js.cookie.js' %}"></script>
<script src="{% static 'assets/vendor/jquery.scrollbar/jquery.scrollbar.min.js' %}"></script>
<script src="{% static 'assets/vendor/jquery-scroll-lock/dist/jquery-scrollLock.min.js' %}"></script>
<script src="{% static 'assets/vendor/bootstrap/dist/js/bootstrap.bundle.min.js' %}"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      document.body.addEventListener('click', function(e) {
        const actionEl = e.target.closest('[data-action]');
        if (!actionEl) return;
        const action = actionEl.getAttribute('data-action');
        if (action === 'search-show') {
          e.preventDefault();
          document.body.classList.remove('g-navbar-search-show', 'g-navbar-search-hidden', 'g-navbar-search-hiding');
          document.body.classList.add('g-navbar-search-showing');
          setTimeout(function() {
            document.body.classList.remove('g-navbar-search-showing');
            document.body.classList.add('g-navbar-search-show');
            setTimeout(function() {
              document.body.classList.add('g-navbar-search-shown');
              const input = document.querySelector('#navbar-search-main input.form-control');
              if (input) input.focus();
            }, 150);
          }, 150);
        } else if (action === 'search-close') {
          e.preventDefault();
          document.body.classList.remove('g-navbar-search-shown');
          setTimeout(function() {
            document.body.classList.remove('g-navbar-search-show');
            document.body.classList.add('g-navbar-search-hiding');
            setTimeout(function() {
              document.body.classList.remove('g-navbar-search-hiding');
              document.body.classList.add('g-navbar-search-hidden');
              setTimeout(function() {
                document.body.classList.remove('g-navbar-search-hidden');
              }, 200);
            }, 150);
          }, 150);
        }
      });
    });
  </script>
  <!-- Auto-close sidebar when clicking outside -->
  <script>
    document.addEventListener('click', function (e) {
      const body = document.body;
      const sidenav = document.getElementById('sidenav-main');
      if (!sidenav) return;

      const clickedInsideSidenav = !!e.target.closest('#sidenav-main');
      const clickedToggler = !!e.target.closest('.sidenav-toggler');

      const isSidenavOpen = body.classList.contains('g-sidenav-show') && !body.classList.contains('g-sidenav-hidden');
      const isPinned = body.classList.contains('g-sidenav-pinned');

      // Jika sidebar terbuka dan klik di luar area sidebar & bukan tombol toggler â†’ tutup
      if (isSidenavOpen && !clickedInsideSidenav && !clickedToggler) {
        // Hilangkan state 'nav-open' dan backdrop jika ada
        body.classList.remove('nav-open', 'g-sidenav-show', 'g-sidenav-hide');
        body.classList.add('g-sidenav-hidden');

        const backdrop = document.querySelector('.backdrop');
        if (backdrop) backdrop.remove();

        // Jika pinned, sekaligus lepaskan pin agar konsisten
        if (isPinned) {
          body.classList.remove('g-sidenav-pinned');
          const toggler = document.querySelector('.sidenav-toggler');
          if (toggler) {
            toggler.classList.remove('active');
            toggler.setAttribute('data-action', 'sidenav-pin');
          }
        }
      }
    });
  </script>