{% extends "layouts/base.html" %}
{% load static %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="header bg-primary pb-6">
    <div class="container-fluid">
        <div class="header-body">
            <div class="row align-items-center py-4">
                <div class="col-lg-6 col-7">
                    <h6 class="h2 text-white d-inline-block mb-0">{{ title }}</h6>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container-fluid mt--6">
    <div class="row">
        <div class="col-12">
            <div class="card shadow-soft border-0">
                <div class="card-body">
                    {% if absensi_hari_ini.jam_pulang %}
                        <div class="alert alert-success alert-dismissible fade show border-0 shadow-sm" role="alert">
                            <span class="alert-icon"><i class="ni ni-like-2"></i></span>
                            <span class="alert-text"><strong>Selesai!</strong> Anda sudah melakukan absen pulang hari ini. Sampai jumpa besok!</span>
                            <hr class="my-3">
                            <p class="mb-0">
                                Waktu absen masuk: <strong>{{ absensi_hari_ini.jam_masuk|time:"H:i:s" }}</strong><br>
                                Waktu absen pulang: <strong>{{ absensi_hari_ini.jam_pulang|time:"H:i:s" }}</strong><br>
                                Alamat Pulang: <strong>{{ absensi_hari_ini.alamat_pulang|default:"-" }}</strong>
                            </p>
                        </div>
                    {% else %}
                        <!-- 3 Info Cards Row -->
                        <div class="row mb-4">
                            <div class="col-4">
                                <div class="rounded p-3 text-center" style="background: #1368A3;">
                                    <i class="ni ni-watch-time text-white mb-2" style="font-size: 1.25rem;"></i>
                                    <p class="text-white-50 text-xs mb-1">Waktu</p>
                                    <h4 id="liveClock" class="text-white mb-0 font-weight-bold">--:--:--</h4>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="rounded p-3 text-center" style="background: #1368A3;">
                                    <i class="ni ni-time-alarm text-white mb-2" style="font-size: 1.25rem;"></i>
                                    <p class="text-white-50 text-xs mb-1">Jam Masuk</p>
                                    <h4 class="text-white mb-0 font-weight-bold">{{ absensi_hari_ini.jam_masuk|time:'H:i' }}</h4>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="rounded p-3 text-center" style="background: #1368A3;">
                                    <i class="ni ni-calendar-grid-58 text-white mb-2" style="font-size: 1.25rem;"></i>
                                    <p class="text-white-50 text-xs mb-1">Tanggal</p>
                                    <h4 class="text-white mb-0 font-weight-bold">{% now 'd M' %}</h4>
                                </div>
                            </div>
                        </div>

                        <!-- Location & Submit Row -->
                        <div class="row align-items-start">
                            <div class="col-lg-6 mb-3 mb-lg-0">
                                <div id="locationCard" class="location-card shadow-sm mb-3">
                                    <div class="d-flex align-items-center">
                                        <div class="location-icon-wrapper mr-3">
                                            <i id="locationIcon" class="fas fa-location-arrow text-warning"></i>
                                        </div>
                                        <div class="location-details">
                                            <div id="locationStatusText" class="status-main">Mendeteksi Lokasi...</div>
                                            <div id="locationSubText" class="status-sub">Sedang mengambil koordinat GPS Anda</div>
                                        </div>
                                    </div>
                                    
                                    <div id="locationCoords" class="mt-2 pt-2 border-top" style="display: none; border-color: rgba(0,0,0,0.05) !important;">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <span class="text-muted small">
                                                <i class="fas fa-crosshairs mr-1"></i> 
                                                <span id="latitude">-</span>, <span id="longitude">-</span>
                                            </span>
                                            <span class="badge badge-light badge-sm text-muted" title="Akurasi GPS">
                                                Â± <span id="accuracy">-</span>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                {% if is_overtime %}
                                <div class="alert alert-info mb-3" role="alert">
                                    <i class="fas fa-business-time mr-2"></i>
                                    <strong>Overtime!</strong> {{ overtime_message }}
                                </div>
                                {% endif %}
                                
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <p class="text-muted text-sm mb-0">
                                        <i class="ni ni-time-alarm mr-1"></i> Durasi kerja: <strong id="durasiKerjaEl">{{ jam_kerja_h }} jam {{ jam_kerja_m }} menit</strong>
                                    </p>
                                    {% if not is_intern %}
                                    <span id="minDurasiBadge" class="badge badge-{% if jam_kerja >= min_work_hours %}success{% else %}warning{% endif %} badge-pill">
                                        Minimum: {{ min_work_hours }} jam
                                    </span>
                                    {% else %}
                                    <span id="minDurasiBadge" class="badge badge-info badge-pill">Intern absen pulang jam {{ intern_co_time }}</span>
                                    {% endif %}
                                </div>
                                
                                <form id="absenForm" method="post" action="{% url 'absen_pulang_fleksibel' %}" enctype="multipart/form-data">
                                    {% csrf_token %}
                                    <input type="hidden" name="id_karyawan" value="{{ karyawan.id }}">
                                    <input type="hidden" name="lokasi" id="hiddenLokasi" value="">
                                    <input type="hidden" name="latitude" id="hiddenLatitude">
                                    <input type="hidden" name="longitude" id="hiddenLongitude">
                                    <input type="hidden" name="confirm_early" id="confirmEarly" value="">
                                    <input type="hidden" id="isWfaData" value="{{ is_wfa|yesno:'true,false' }}">
                                    <input type="hidden" id="wfaKeteranganData" value="{{ wfa_keterangan|default:'' }}">
                                    <input type="hidden" id="needsConfirmation" value="{{ needs_confirmation|yesno:'true,false' }}">
                                    <input type="hidden" id="minWorkHours" value="{{ min_work_hours }}">
                                    <input type="hidden" id="isOvertime" value="{{ is_overtime|yesno:'true,false' }}">
                                    <input type="hidden" id="overtimeThreshold" value="{{ overtime_threshold }}">
                                    <input type="hidden" id="ciDiKantor" value="{{ ci_di_kantor|yesno:'true,false' }}">
                                    <input type="hidden" id="checkinDatetimeIso" value="{{ checkin_datetime_iso|default:'' }}">
                                    <input type="hidden" id="checkoutBlocked" value="{{ checkout_blocked|yesno:'true,false' }}">
                                    <input type="hidden" id="ciLuarCoAseecMinTime" value="{{ ci_luar_co_aseec_min_time|default:'18:30' }}">
                                    <input type="hidden" id="isIntern" value="{{ is_intern|yesno:'true,false' }}">
                                    
                                    {% if checkout_blocked %}
                                    <div class="alert alert-danger mb-3">
                                        <i class="fas fa-ban mr-2"></i>
                                        Batas waktu absen pulang adalah pukul {{ max_checkout_time }}. Silakan hubungi HRD.
                                    </div>
                                    {% endif %}
                                    
                                    <!-- CI Luar + CO ASEEC Alert (shown dynamically via JS) -->
                                    <div id="ciLuarCoAseecAlert" class="alert alert-warning mb-3" style="display: none;">
                                        <i class="fas fa-clock mr-2"></i>
                                        CI di luar kantor, CO di kantor: Check-out hanya dapat dilakukan setelah pukul <span id="ciLuarCoAseecMinTimeDisplay">18:30</span> WIB.
                                    </div>
                                    
                                    <!-- WFA Documentation Section (shown when CO outside office) -->
                                    <div id="wfaDocumentationSection" style="display: none;" class="mb-4">
                                        <div class="card border-info">
                                            <div class="card-header bg-info text-white py-2">
                                                <strong>Dokumentasi WFA Diperlukan</strong>
                                                <i class="fas fa-info-circle ml-2" style="font-size: 0.9rem; cursor: help;" data-toggle="tooltip" data-placement="top" title="Karena Anda check-out di luar kantor, mohon lengkapi dokumentasi WFA:"></i>
                                            </div>
                                            <div class="card-body">
                                                <div class="form-group">
                                                    <label for="aktivitas_wfa" class="font-weight-bold">
                                                        Aktivitas yang dikerjakan hari ini <span class="text-danger">*</span>
                                                    </label>
                                                    <textarea 
                                                        name="aktivitas_wfa" 
                                                        id="aktivitas_wfa" 
                                                        class="form-control" 
                                                        rows="3"
                                                    ></textarea>
                                                </div>
                                                
                                                <div class="form-group mb-0">
                                                    <label for="dokumen_persetujuan" class="font-weight-bold">
                                                        SS Chat Izin Atasan Langsung <span class="text-danger">*</span>
                                                    </label>
                                                    <input 
                                                        type="file" 
                                                        name="dokumen_persetujuan" 
                                                        id="dokumen_persetujuan"
                                                        class="form-control-file"
                                                        accept=".png,.jpg,.jpeg,.pdf"
                                                    />
                                                    <small class="form-text text-muted">
                                                        Upload screenshot/scan persetujuan yang sudah di-approve atasan (.png, .jpg, atau .pdf, max 5MB)
                                                    </small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Tooltip wrapper for disabled button -->
                                    <div id="absenButtonWrapper" class="tooltip-wrapper-disabled" style="display: inline-block; width: 100%;">
                                        <button type="submit" id="absenButton" class="btn btn-warning btn-lg btn-block" {% if checkout_blocked %}disabled{% endif %} style="border-radius: 12px;">
                                            <i class="fas fa-door-open mr-2"></i> Submit Absen Pulang
                                        </button>
                                    </div>
                                    <div id="izinPulangAwalHint" class="text-center mt-2" style="display: none;">
                                        <small class="text-muted">
                                            <i class="fas fa-info-circle mr-1"></i>
                                            Perlu pulang lebih awal? <a href="{% url 'pengajuan_izin' %}" class="font-weight-bold">Ajukan Izin Pulang Awal</a>
                                        </small>
                                    </div>
                                </form>
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

{% include 'includes/footer.html' %}
{% endblock %}

{% block javascripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize Bootstrap tooltips
        if (typeof $ !== 'undefined' && $.fn.tooltip) {
            $('[data-toggle="tooltip"]').tooltip();
        }
        
        // Live Clock
        function updateClock() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            document.getElementById('liveClock').textContent = `${hours}:${minutes}:${seconds}`;
        }
        updateClock();
        setInterval(updateClock, 1000);

        const locationCard = document.getElementById('locationCard');
        const locationIcon = document.getElementById('locationIcon');
        const locationStatusText = document.getElementById('locationStatusText');
        const locationSubText = document.getElementById('locationSubText');
        const locationCoords = document.getElementById('locationCoords');
        const latitudeEl = document.getElementById('latitude');
        const longitudeEl = document.getElementById('longitude');
        const accuracyEl = document.getElementById('accuracy');
        const hiddenLatitude = document.getElementById('hiddenLatitude');
        const hiddenLongitude = document.getElementById('hiddenLongitude');
        const absenButton = document.getElementById('absenButton');
        const absenForm = document.getElementById('absenForm');
        
        // Initialize values from hidden inputs
        const isWfaFromTemplate = document.getElementById('isWfaData')?.value === 'true';
        const wfaKeterangan = document.getElementById('wfaKeteranganData')?.value || "";
        const needsConfirmation = document.getElementById('needsConfirmation')?.value === 'true';
        const minWorkHours = parseFloat(document.getElementById('minWorkHours')?.value || '8.5');
        const isIntern = document.getElementById('isIntern')?.value === 'true';
        const ciDiKantor = document.getElementById('ciDiKantor')?.value === 'true';
        const checkinDatetimeIso = document.getElementById('checkinDatetimeIso')?.value || '';
        const checkoutBlocked = document.getElementById('checkoutBlocked')?.value === 'true';

        let wfaPureDurationInterval = null;
        let isWfaPure = false;
        let ciLuarCoAseecInterval = null;
        let isCiLuarCoAseec = false;
        
        // Hint untuk Izin Pulang Awal saat button disabled
        const izinPulangAwalHint = document.getElementById('izinPulangAwalHint');
        
        function updateIzinPulangAwalHint() {
            if (!izinPulangAwalHint || !absenButton) return;
            // Tampilkan hint jika button disabled
            if (absenButton.disabled) {
                izinPulangAwalHint.style.display = 'block';
            } else {
                izinPulangAwalHint.style.display = 'none';
            }
        }

        function getDurationHours() {
            if (!checkinDatetimeIso) return 0;
            const checkin = new Date(checkinDatetimeIso);
            if (isNaN(checkin.getTime())) return 0;
            return (Date.now() - checkin.getTime()) / (1000 * 3600);
        }

        function updateDurationDisplay() {
            const el = document.getElementById('durasiKerjaEl');
            const badge = document.getElementById('minDurasiBadge');
            if (!el || !badge) return;
            const totalHours = getDurationHours();
            const h = Math.floor(totalHours);
            const m = Math.floor((totalHours - h) * 60);
            el.textContent = `${h} jam ${m} menit`;
            badge.classList.toggle('badge-success', totalHours >= minWorkHours);
            badge.classList.toggle('badge-warning', totalHours < minWorkHours);
        }

        function applyWfaPureButtonState() {
            const durasiEl = document.getElementById('durasiKerjaEl');
            const badge = document.getElementById('minDurasiBadge');
            if (!absenButton || !durasiEl || !badge) return;
            const duration = getDurationHours();
            const h = Math.floor(duration);
            const m = Math.floor((duration - h) * 60);
            durasiEl.textContent = `${h} jam ${m} menit`;
            if (!isIntern) {
                badge.classList.remove('badge-success');
                badge.classList.remove('badge-warning');
                badge.classList.add(duration >= minWorkHours ? 'badge-success' : 'badge-warning');
            }
            if (checkoutBlocked) {
                absenButton.disabled = true;
                absenButton.classList.remove('btn-warning');
                absenButton.classList.add('btn-secondary');
                if (wfaPureDurationInterval) { clearInterval(wfaPureDurationInterval); wfaPureDurationInterval = null; }
                return;
            }
            // Intern: no 8.5h minimum, always allow CO for WFA pure
            if (isIntern) {
                absenButton.disabled = false;
                absenButton.classList.remove('btn-secondary');
                absenButton.classList.add('btn-warning');
                if (wfaPureDurationInterval) { clearInterval(wfaPureDurationInterval); wfaPureDurationInterval = null; }
            } else if (duration < minWorkHours) {
                absenButton.disabled = true;
                absenButton.classList.remove('btn-warning');
                absenButton.classList.add('btn-secondary');
                if (!wfaPureDurationInterval) {
                    wfaPureDurationInterval = setInterval(applyWfaPureButtonState, 30000);
                }
            } else {
                absenButton.disabled = false;
                absenButton.classList.remove('btn-secondary');
                absenButton.classList.add('btn-warning');
                if (wfaPureDurationInterval) { clearInterval(wfaPureDurationInterval); wfaPureDurationInterval = null; }
            }
            updateIzinPulangAwalHint();
        }

        // CI luar + CO ASEEC: checkout hanya boleh setelah 18:30
        function applyCiLuarCoAseecButtonState() {
            const ciLuarCoAseecAlert = document.getElementById('ciLuarCoAseecAlert');
            const minTimeStr = document.getElementById('ciLuarCoAseecMinTime')?.value || '18:30';
            const minTimeDisplay = document.getElementById('ciLuarCoAseecMinTimeDisplay');
            if (minTimeDisplay) minTimeDisplay.textContent = minTimeStr;
            
            const [minHour, minMin] = minTimeStr.split(':').map(Number);
            const minMinutes = minHour * 60 + minMin;
            
            const now = new Date();
            const currentMinutes = now.getHours() * 60 + now.getMinutes();
            
            if (checkoutBlocked) {
                absenButton.disabled = true;
                absenButton.classList.remove('btn-warning');
                absenButton.classList.add('btn-secondary');
                if (ciLuarCoAseecAlert) ciLuarCoAseecAlert.style.display = 'none';
                if (ciLuarCoAseecInterval) { clearInterval(ciLuarCoAseecInterval); ciLuarCoAseecInterval = null; }
                return;
            }
            
            if (currentMinutes < minMinutes) {
                absenButton.disabled = true;
                absenButton.classList.remove('btn-warning');
                absenButton.classList.add('btn-secondary');
                if (ciLuarCoAseecAlert) ciLuarCoAseecAlert.style.display = 'block';
                // Re-check setiap menit
                if (!ciLuarCoAseecInterval) {
                    ciLuarCoAseecInterval = setInterval(applyCiLuarCoAseecButtonState, 60000);
                }
            } else {
                absenButton.disabled = false;
                absenButton.classList.remove('btn-secondary');
                absenButton.classList.add('btn-warning');
                if (ciLuarCoAseecAlert) ciLuarCoAseecAlert.style.display = 'none';
                if (ciLuarCoAseecInterval) { clearInterval(ciLuarCoAseecInterval); ciLuarCoAseecInterval = null; }
            }
            updateIzinPulangAwalHint();
        }

        function updateLocationUI(state, title, sub, iconClass, cardClass) {
            locationStatusText.textContent = title;
            locationSubText.textContent = sub;
            locationIcon.className = iconClass;
            locationCard.className = 'location-card shadow-sm mb-3 ' + cardClass;
        }

        // Handle form submission with confirmation for early checkout (non-WFA pure only)
        if (absenForm) {
            absenForm.addEventListener('submit', function(e) {
                if (isWfaPure) return;
                if (isCiLuarCoAseec) return; // Let server-side handle validation
                if (needsConfirmation) {
                    const confirmEarlyInput = document.getElementById('confirmEarly');
                    if (!confirmEarlyInput.value) {
                        e.preventDefault();
                        if (confirm(`Anda belum mencapai ${minWorkHours} jam kerja.\n\nApakah Anda yakin ingin absen pulang sekarang?`)) {
                            confirmEarlyInput.value = 'true';
                            absenForm.submit();
                        }
                    }
                }
            });
        }

        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        const acc = position.coords.accuracy;

                        latitudeEl.textContent = lat.toFixed(6);
                        longitudeEl.textContent = lon.toFixed(6);
                        accuracyEl.textContent = acc.toFixed(1) + ' m';
                        locationCoords.style.display = 'block';

                        hiddenLatitude.value = lat;
                        hiddenLongitude.value = lon;
                        
                        const hiddenLokasi = document.getElementById('hiddenLokasi');
                        if (hiddenLokasi) hiddenLokasi.value = `${lat}, ${lon}`;

                        // Validasi geofencing via API
                        const checkUrl = "{% url 'check_location' %}";
                        fetch(`${checkUrl}?lat=${lat}&lon=${lon}`)
                            .then(response => response.json())
                            .then(data => {
                                // Check if WFA documentation is needed
                                const wfaSection = document.getElementById('wfaDocumentationSection');
                                const aktivitasField = document.getElementById('aktivitas_wfa');
                                const dokumenField = document.getElementById('dokumen_persetujuan');
                                
                                let wfaSub = '';
                                if (data.distance != null && data.radius != null && data.office_name) {
                                    wfaSub = `Jarak ${data.distance} m dari ${data.office_name} (radius ${data.radius} m)`;
                                }
                                if (isWfaFromTemplate || data.is_wfa_day) {
                                    if (data.is_within_geofence) {
                                        updateLocationUI('valid', 'Lokasi Valid', 'Anda berada di area ' + (data.office_name || 'ASEEC'), 'fas fa-check-circle text-success', 'valid');
                                        wfaSection.style.display = 'none';
                                        aktivitasField.required = false;
                                        dokumenField.required = false;
                                    } else {
                                        updateLocationUI('wfa', 'Di Luar Kantor (WFA)', wfaSub, 'fas fa-home text-info', 'wfa');
                                        wfaSection.style.display = 'block';
                                        aktivitasField.required = true;
                                        dokumenField.required = true;
                                    }
                                } else if (data.is_within_geofence) {
                                    updateLocationUI('valid', 'Lokasi Valid', 'Anda berada di area ' + (data.office_name || 'ASEEC'), 'fas fa-check-circle text-success', 'valid');
                                    wfaSection.style.display = 'none';
                                    aktivitasField.required = false;
                                    dokumenField.required = false;
                                } else {
                                    updateLocationUI('wfa', 'Di Luar Kantor (WFA)', wfaSub, 'fas fa-home text-info', 'wfa');
                                    wfaSection.style.display = 'block';
                                    aktivitasField.required = true;
                                    dokumenField.required = true;
                                }

                                // CI luar & CO luar = WFA murni: checkout hanya boleh jika durasi > 8.5 jam
                                const coDiKantor = data.is_within_geofence && !data.is_wfa_day;
                                isWfaPure = !ciDiKantor && !coDiKantor;
                                
                                // NEW: CI luar & CO di ASEEC: checkout hanya boleh setelah 18:30
                                isCiLuarCoAseec = !ciDiKantor && coDiKantor;
                                
                                // DEBUG: Log values for troubleshooting
                                console.log('=== CI/CO Location Debug ===');
                                console.log('ciDiKantor (from backend):', ciDiKantor);
                                console.log('coDiKantor:', coDiKantor);
                                console.log('data.is_within_geofence:', data.is_within_geofence);
                                console.log('data.is_wfa_day:', data.is_wfa_day);
                                console.log('isWfaPure:', isWfaPure);
                                console.log('isCiLuarCoAseec:', isCiLuarCoAseec);

                                if (checkoutBlocked) {
                                    absenButton.disabled = true;
                                    absenButton.classList.remove('btn-warning');
                                    absenButton.classList.add('btn-secondary');
                                } else if (isWfaPure) {
                                    applyWfaPureButtonState();
                                } else if (isCiLuarCoAseec) {
                                    applyCiLuarCoAseecButtonState();
                                } else {
                                    absenButton.disabled = false;
                                    absenButton.classList.remove('btn-secondary');
                                    absenButton.classList.add('btn-warning');
                                }
                                
                                // Update hint based on final button state
                                updateIzinPulangAwalHint();
                            })
                            .catch(error => {
                                console.error('Error checking location:', error);
                                updateLocationUI('error', 'Gagal Validasi', 'Koneksi bermasalah saat mengecek lokasi', 'fas fa-exclamation-triangle text-warning', 'invalid');
                            });
                    },
                    function(error) {
                        let msg = "Gagal mengambil GPS";
                        let detail = "Izin lokasi dibatasi";
                        switch(error.code) {
                            case error.PERMISSION_DENIED: detail = "Klik gembok di address bar untuk mengaktifkan"; break;
                            case error.POSITION_UNAVAILABLE: detail = "Sinyal GPS tidak terdeteksi"; break;
                            case error.TIMEOUT: detail = "Permintaan waktu habis"; break;
                        }
                        updateLocationUI('error', msg, detail, 'fas fa-exclamation-triangle text-danger', 'invalid');
                        locationStatusText.innerHTML += ` <button type="button" class="btn btn-sm btn-link p-0 ml-1 text-primary" onclick="location.reload()">Coba Lagi</button>`;
                    },
                    { enableHighAccuracy: true, timeout: 30000, maximumAge: 0 }
                );
            } else {
                updateLocationUI('error', 'Browser Tidak Support', 'Geolocation tidak tersedia di browser ini', 'fas fa-bug text-danger', 'invalid');
            }
        }

        getLocation();
    });
</script>

<style>
    .location-card {
        border-radius: 12px;
        padding: 16px;
        background: #fff;
        border: 1px solid rgba(0,0,0,0.05);
        transition: all 0.3s ease;
    }
    .location-card.valid { border-left: 5px solid #2dce89; background: #f6fdf9; }
    .location-card.wfa { border-left: 5px solid #11cdef; background: #f0faff; }
    .location-card.invalid { border-left: 5px solid #f5365c; background: #fffcfc; }
    
    .location-icon-wrapper {
        width: 42px;
        height: 42px;
        border-radius: 10px;
        background: rgba(0,0,0,0.03);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
    }
    .valid .location-icon-wrapper { background: rgba(45, 206, 137, 0.1); }
    .wfa .location-icon-wrapper { background: rgba(17, 205, 239, 0.1); }
    .invalid .location-icon-wrapper { background: rgba(245, 54, 92, 0.1); }

    .status-main { font-weight: 700; font-size: 1rem; color: #32325d; margin-bottom: 2px; }
    .status-sub { font-size: 0.85rem; color: #8898aa; }

    .shadow-soft {
        box-shadow: 0 0.75rem 1.5rem rgba(18, 38, 63, 0.03) !important;
    }
    .animate-pulse {
        animation: pulse 2s infinite;
    }
    @keyframes pulse {
        0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(251, 99, 64, 0.7); }
        70% { transform: scale(1.02); box-shadow: 0 0 0 10px rgba(251, 99, 64, 0); }
        100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(251, 99, 64, 0); }
    }
</style>
{% endblock %}
